쿠키와 세션은 왜 등장했을까?

HTTP 통신은 요청(Request) → 응답(Response)이 종료되면 stateless(상태가 유지되지 않은)한 특징 때문에 연결을 끊는 처리 방식을 갖는다.

로그인과 같은 일을 할 때 누가 로그인 중인지 상태를 기억하기 위해 쿠키, 세션, 토큰을 사용한다.

# 🍪 쿠키

쿠키는 공개 가능한 정보를 사용자의 브라우저에 저장시킨다.

- 서버는 클라이언트의 로그인 요청에 대한 응답을 작성할 때, 클라이언트 측에 저장하고 싶은 정보를 응답헤더의 `set-cookie`에 담는다.

- 이후 클라이언트가 재요청 할 때마다 저장된 쿠키를 요청 헤더의 `cookie`에 담아 보낸다.

- 서버는 쿠키에 담긴 정보를 바탕으로 해당 요청의 클라이언트가 누군지 식별 할 수 있다.

# 🔒 세션

예를 들어 사용자의 로그인 상태를 유지하는 기능을 위해 쿠키에 아이디와 비밀번호를 담아두고 있다. 이렇게 된다면 개인 소유가 아닌 컴퓨터에서 사용할 경우 사용자의 개인정보가 털릴 것이고, http로 개인정보를 주고 받다보면 쿠키가 유출, 조작이 될 수 있는 보안상 큰 문제를 야기한다.

session은 비밀번호와 같은 인증 정보를 쿠키에 저장하지 않고 대신에 사용자의 식별자인 `session id`를 저장한다. 서버에는 인증 정보와 더불어 이 ID에 해당하는 사요아의 정보를 저장한다.

세션은 서버에 저장하기 때문에 사용자가 수백, 수천, 수만으로 늘어난다면 해당 유저의 정보를 찾고 데이터 매칭에 오랜 시간이 걸리면서 서버에 부하가 가해지게 된다.

# 💰 토큰(JWT)

메모리 공간을 많이 차지하는 세션 방식의 대안은 로그인한 사용자에게 세션 아이디 대신 토큰을 발급해 주는 것이다.

이러한 토큰에는 특수한 수학적 원리가 적용되어 있어서 마치 위조 방지 방치가 있는 지폐처럼 서버만이 유효한 토큰을 발행할 수 있다.

토큰을 받아간 사용자가 이를 쿠키로 저장해 두고 필요할 때마다 제시하면 서버는 따로 확인이 필요 없이 자기가 발급한 토큰임을 확인하고 사용자에게 요청을 허가해 주는 것이다.

더 이상 이미 로그인한 사용자의 티켓을 메모리에 올려 두고 있을 필요가 없으니 서버 부하를 줄일 수 있다.

물론 토큰 방식에도 한계는 있다. 여러 기기에서의 로그인을 제한하기 위해 필요한 때 에 로그인되어 있는 사용자를 서버가 강제로 로그아웃을 시킬 수 있어야 하는데, 토큰 방식에서는 이것이 불가능하다. 한 번 발행한 토큰은 유효기간이 끝나기 전까지 따로 통제할 수 없기 때문에 세션에 비해 토큰 정보를 탈취 당할 가능성이 높다. 그러나 토큰은 쿠키처럼 만료 기간을 정할 수 있어서 만료 시간을 짧게 지정해 피해를 줄일 수 있습니다. 토큰방식은 쿠키와 세션을 적절히 섞은 것과 비슷하다.
